# 컨테이너 기술

컨테이너 기술은 애플리케이션과 그 종속성을 함께 패키징하여, 운영체제 수준에서 격리된 환경을 제공하는 기술.

## 가상화의 목적과 이점

가상화는 물리적 하드웨어 리소스를 추상화하여 여러 가상 환경을 생성하고 관리하는 기술입니다. 이를 통해 다음과 같은 이점을 얻을 수 있습니다.

1. 효율적인 리소스 사용:

   - 여러 가상 환경이 하나의 물리적 하드웨어 공유? 리소스 사용률을 극대화 할 수 있음.

2. 유지보수 용이성:

   - 물리적 하드웨어 유지보수의 관리 최소화, 소프트웨어적으로 관리 가능.

3. 유연성 및 확장성:

   - 필요에 따라 가상 환경을 쉽게 생성하고 제거 가능, 빠른 확장성과 유연성을 제공합니다.

## 초기 컨테이너 기술

    1991 - chroot: 초기 컨테이너 기술은 리눅스 커널에서 제공하는 chroot 시스템 호출을 기반으로 했습니다.
    ...

## 가상 머신(VM) 가상화 기술

    2010 - VM 가상화: VMware와 VirtualBo와 같은 가상 머신 기술이 등장하면서, 하드웨어 수준에서의 가상화가 가능해졌습니다

## 컨테이너 가상화 기술

    2013 - Docker: Docker는 컨테이너 기술을 더욱 발전시켜, 애플리케이션과  그 종속성을 포함하는 컨테이너  이미지를 생성하고, 이를 다양한 환경에서 일관되게 실행 할 수 있음.

## 컨테이너 오케스트레이션 도구

    2015 - Kubernetes, AWS, CI/CD 도구: 컨테이너 기술을 발전과 함께, 대규모 컨테이너  환경을 관리하기 위한 오케스트레이션 도구들이 등장.

    - Kubernetes: 컨테이너의 배포, 확장, 관리를 자동화하는 오케스트레이션 플랫폼.
    - CI/CD도구: 지속적 통합(CI)과 지속적 배포(CD)를 지원하는 도구들이 컨테이너와 함께 사용되어, 애플리케이션의 개발과 배포를 자동화하고 가속화합니다.

## 가상화와 컨테이너의 차이점

    가상 머신 (VM)
        - 각각의 VM은 운영체제를 포함, 하이퍼바이저를 통해 물리적 하드웨어를 가상화합니다.
        - 리소스 오버헤드가 상대적으로 크며, 부팅 시간이 오래 걸릴 수 있음.

    컨테이너:
        - 컨테이너는 운영체제 커널을 공유, 애플리케이션과 그 종석성만을 포함.
        - 가볍고 빠르며, 리소스 사용 효율이 높습니다.

## 애플리케이션 배포 방식 비교

    일반 서버(온프레미스):
        - 직접 하드웨어에 운영체제를 설치 후, 애플리케이션을 배포하는 방식.
        - 유지보수와 관리가 어렵고, 확장성이 낮음.

    도커 컨테이너:
        - 애플리케이션 그 종속성을 포함하는 컨테이너 이미지 생성,  이를 다양한  환경에서 일관되게 실행 가능.
        - 빠르고 유연한 배포 가능, 확장성 유지보수 용이.

## 컨테이너 기술

    - 리눅스 컨테이너 기술은 LXC를 이용한 시스템 컨테이너화로 시작됨.

    - 이후 애플리케이션 컨테이너 기반의 Docker가 출시, 초기 Docker 버전은 LX를 활용해 컨테이너를 생성했습니다.

    - 지속된 컨테이너 엔진의 발전으로 Docker는 containered, runC를 이용하는 방식으로 변경됨.
        - runC: 커널 기술의 공유를 통해 컨테이너 생성을 지원.
        - containerd: 생성된 컨테이너의 라이프사이클 관리를 지원합니다.
        - dockerd: 사용자 환경에서의 명령을 전달합니다.

    - 컨테이너 기술의 발전
        - LXC 컨테이너: 초기 리눅스 컨테이너 기술로, 시스템 전체를 컨테이너화하는 방식.
        - libcontainer: Docker에서 LXC를 대체하여 사용한 라이브러리입니다.
        - containerd, runC, dockerd: 현재 Docker 엔진에서 사용되는 주요 컴포넌트입니다.

## Docker 구성 요소

    - Docker CLI API: 사용자 명령을 Docker 엔진에 전달하는 인터페이스입니다.
    - swarmkit: Docker의 네이티브 오케스트레이션 도구로, 컨테이너 클러스터를 관리합니다.
    - Logs management: 컨테이너의 로그를 관리하고, 수집, 저장, 조회할 수 있는 기능을 제공합니다.
    - Storage management: 컨테이너의 스토리지를 관리하며, 볼륨을 통해 데이터의 영속성을 제공합니다.
    - libnetwork: 컨테이너 간의 네트워크를 구성하고 관리하는 라이브러리입니다.
    - buildkit: Docker 이미지를 빌드하는 도구로, 효율적이고 빠른 빌드를 지원합니다.
    - DCT: Docker 이미지의 신뢰성과 무결성을 보장하는 기능입니다.
    - Image management: Docker 이미지를 관리하며, 이미지의 생성, 저장, 배포 등을 지원합니다.

## 최신 Docker 사용해야 하는 이유?

기준에 사용하던 컨테이너, 이미지들이 안 맞을 수 있음.
현재 사용하는 버전을 유지해야 할 지, 업데이트를 해야 할 지 고민 해 봐야함.

1. docker 엔진을 무조건 업데이트 해야 하느냐?
2. 기존 기능의 개선 및 new feature, 버그 수정 PR 이 업데이트 됨.
3. 취약점 패치
4. 성능 개선
5. 최신 기술과의 호환성: 컨테이너 환경에서 새로운 최신 tool들을 활용 가능
6. 커뮤니티 및 생태계 지원: docker 기반 플러그인 및 통합을 활용해 컨테이너화 된 application을 build 및 관리하기 위한 옵션을 사용 가능합니다.

## Docker Image 구조

- docker image는 Container runtime 에 필요한 바이너리, 라이브럴 ㅣ및 설정 값 포함하고, 변경되는 상태 값을 보유하지 않고(stateless) 변하지 않는다.

1. 애플리케이션 코드 개발.
2. 베이스이미지를 이용한 dockerfile 작성
3. Dockerfile build를 통한 새로운 이미지 생성.
4. 도커컴포즈를 이용한 다중 컨테이너 실행
   5-2. 마이크로서비스 테스트
   4-1 생성된 이미지를 이용한 컨테이너 실행
   5-1. 컨테이너 애플리케이션 서비스 테스트
5. 로컬 및 원격 저장소에 이미지 저장(push)
6. Github 등을 활용한 Dockerfile 관리
7. 동일환경에서의 지속적 애플리케이션 개발 수행

docker image 관련 명령어 workflow

## 이미지 내려 받기

- Docker는 hub.docker.com(docker.io)으로 부터 이미지를 제공 받거나 제공한다.
- 또는, 기업의 인프라에 개별적 Private registry 서버를 두고, 이곳에 이미지를 pull/push 하기도 한다.

이미지 구조 확인

- docker image inspect httpd:2.4 -> (sha256, image url, created, container, containerConfig ...)

이미지는 절대 수정이 안됨.(불변성을 가짐)
GraphDriver -> Layers

이미지 구조 확인
-> docker image inspect: 생성된 image의 내부 구조 정보를 JSON 형태로 제공.

## docker container registry

- 기업 내부 생성한 프로젝트용 이미지를 public registry에 올리는 경우는 없습니다.
- image에 네트워크나 OS 및 미들웨어 설정 등 정보가 포함되어 있을경우 Private Registry 구축
- Docker registry는 docker image를 회사 서버에서 개별적 구축 관리하는 서비스.
- 회사 인프라내에 private docker registry를 구축하기 위해서, Docker Hub에 공개되어 있는 image인 `registry`를 사용한다.
- 적은 용량의 container service로 사용하기에 적합합니다.

- docker pull registry
- docker images | grep registry
- docker run -d \
